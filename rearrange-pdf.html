<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Organize PDF - Rearrange, Rotate & Remove Pages Online</title>
    <meta name="description" content="Free online tool to rearrange PDF pages, delete unwanted pages, and rotate PDF documents. No software installation. 100% secure client-side processing.">
    
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <style>
        :root { --primary: #e74c3c; --bg: #f8f9fa; --surface: #fff; --border: #dee2e6; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: #333; margin: 0; padding-bottom: 60px; }
        
        /* Layout */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { text-align: center; margin-bottom: 40px; padding: 40px 20px; background: var(--surface); border-bottom: 1px solid var(--border); }
        h1 { margin: 0 0 10px; color: #2c3e50; }

        /* Upload Area */
        .upload-zone { 
            border: 2px dashed #ccc; border-radius: 12px; padding: 40px; text-align: center; 
            background: #fff; cursor: pointer; transition: 0.2s; margin-bottom: 30px;
        }
        .upload-zone:hover { border-color: var(--primary); background: #fff5f5; }
        
        /* Toolbar (FIXED) */
        .toolbar { 
            display: flex; /* This was 'none' before - Fixed */
            justify-content: space-between; 
            align-items: center; 
            background: #34495e; 
            color: white; 
            padding: 15px 20px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            position: sticky; 
            top: 10px; 
            z-index: 100; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        }
        .tool-group { display: flex; gap: 10px; align-items: center; }
        .action-btn { background: rgba(255,255,255,0.1); border: none; color: white; padding: 8px 15px; border-radius: 4px; cursor: pointer; transition: 0.2s; }
        .action-btn:hover { background: rgba(255,255,255,0.2); }
        
        /* Download Button Style */
        .save-btn { 
            background: var(--primary); 
            font-weight: bold; 
            padding: 10px 20px;
            font-size: 15px;
        }
        .save-btn:hover { background: #c0392b; }

        /* Grid System */
        #pageGrid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; padding: 10px; }
        
        /* Page Card */
        .page-card { 
            background: #fff; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; 
            position: relative; cursor: grab; transition: transform 0.2s, box-shadow 0.2s; user-select: none;
            display: flex; flex-direction: column;
        }
        .page-card:hover { box-shadow: 0 5px 15px rgba(0,0,0,0.1); transform: translateY(-2px); border-color: var(--primary); }
        .page-card.dragging { opacity: 0.4; border: 2px dashed var(--primary); }
        
        .thumb-container { height: 200px; background: #eee; display: flex; justify-content: center; align-items: center; overflow: hidden; position: relative; }
        .thumb-img { max-width: 100%; max-height: 100%; object-fit: contain; transition: transform 0.3s; }
        
        .page-info { padding: 10px; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #eee; background: #fff; }
        .page-num { font-weight: bold; color: #666; font-size: 14px; }
        
        .card-actions { display: flex; gap: 5px; }
        .icon-btn { background: none; border: none; cursor: pointer; color: #666; font-size: 16px; padding: 4px; border-radius: 4px; }
        .icon-btn:hover { background: #eee; color: var(--primary); }
        
        /* Loader */
        #loader { display: none; text-align: center; padding: 40px; }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Content */
        .content-section { background: white; padding: 40px; margin-top: 60px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    </style>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6196194515460390"
     crossorigin="anonymous"></script>
</head>
<body>

    <header>
        <div class="container">
            <h1>Organize PDF Pages</h1>
            <p>Rearrange, Rotate, and Delete pages. 100% Free & Private.</p>
        </div>
    </header>

    <div class="container">
        
        <div id="uploadSection" class="upload-zone" onclick="document.getElementById('fileInput').click()">
            <p style="font-size: 40px; margin-bottom: 10px;">üìÑ</p>
            <h3>Click to Upload PDF</h3>
            <p style="color:#777">or drag and drop file here</p>
            <input type="file" id="fileInput" accept="application/pdf" style="display:none">
        </div>

        <div id="loader">
            <div class="spinner"></div>
            <p>Generating Page Thumbnails... (Large files may take a moment)</p>
        </div>

        <div id="editorArea" style="display:none;">
            <div class="toolbar">
                <div class="tool-group">
                    <span style="font-weight: bold; font-size: 18px;">Editor</span>
                </div>
                <div class="tool-group">
                    <button class="action-btn" onclick="resetGrid()">Reset All</button>
                    <button class="action-btn save-btn" id="downloadBtn">Download PDF</button>
                </div>
            </div>

            <div id="pageGrid"></div>
        </div>

        <div class="content-section">
            <h2>How to use</h2>
            <ol>
                <li><strong>Drag & Drop</strong> pages to reorder them.</li>
                <li>Click <strong>üóëÔ∏è</strong> to remove a page.</li>
                <li>Click <strong>‚Üª</strong> to rotate a page.</li>
                <li>Click <strong>Download PDF</strong> to save.</li>
            </ol>
        </div>

    </div>

    <script>
        // --- Configuration ---
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        let pdfDoc = null;
        let pdfBytes = null;
        let pagesData = []; 

        // --- DOM Elements ---
        const fileInput = document.getElementById('fileInput');
        const uploadSection = document.getElementById('uploadSection');
        const loader = document.getElementById('loader');
        const editorArea = document.getElementById('editorArea');
        const pageGrid = document.getElementById('pageGrid');
        const downloadBtn = document.getElementById('downloadBtn');

        // --- Event Listeners ---
        fileInput.addEventListener('change', handleFile);
        uploadSection.addEventListener('dragover', (e) => { e.preventDefault(); uploadSection.style.borderColor = '#e74c3c'; });
        uploadSection.addEventListener('dragleave', () => uploadSection.style.borderColor = '#ccc');
        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            if(e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFile({ target: { files: e.dataTransfer.files } });
            }
        });

        // --- Logic ---

        async function handleFile(e) {
            const file = e.target.files[0];
            if (!file || file.type !== 'application/pdf') return;

            uploadSection.style.display = 'none';
            loader.style.display = 'block';

            try {
                const arrayBuffer = await file.arrayBuffer();
                pdfBytes = arrayBuffer;
                pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                
                const loadingTask = pdfjsLib.getDocument(new Uint8Array(arrayBuffer));
                const pdfRenderDoc = await loadingTask.promise;

                pagesData = [];
                
                for (let i = 1; i <= pdfRenderDoc.numPages; i++) {
                    const page = await pdfRenderDoc.getPage(i);
                    const viewport = page.getViewport({ scale: 0.4 });
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    await page.render({ canvasContext: ctx, viewport: viewport }).promise;
                    
                    pagesData.push({
                        originalIndex: i - 1, 
                        rotation: 0,
                        thumbnail: canvas.toDataURL()
                    });
                }

                renderGrid();
                loader.style.display = 'none';
                editorArea.style.display = 'block'; // This shows the container (and the toolbar inside it)

            } catch (err) {
                console.error(err);
                alert("Error processing PDF. Try another file.");
                location.reload();
            }
        }

        function renderGrid() {
            pageGrid.innerHTML = '';
            pagesData.forEach((data, displayIndex) => {
                const card = document.createElement('div');
                card.className = 'page-card';
                card.draggable = true;
                card.dataset.index = displayIndex;

                card.innerHTML = `
                    <div class="thumb-container">
                        <img src="${data.thumbnail}" class="thumb-img" style="transform: rotate(${data.rotation}deg)">
                    </div>
                    <div class="page-info">
                        <span class="page-num">Pg ${data.originalIndex + 1}</span>
                        <div class="card-actions">
                            <button class="icon-btn" onclick="rotatePage(${displayIndex})" title="Rotate">‚Üª</button>
                            <button class="icon-btn" onclick="deletePage(${displayIndex})" title="Delete" style="color:#e74c3c">üóë</button>
                        </div>
                    </div>
                `;

                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragover', handleDragOver);
                card.addEventListener('drop', handleDrop);
                card.addEventListener('dragend', handleDragEnd);

                pageGrid.appendChild(card);
            });
        }

        window.rotatePage = (index) => {
            pagesData[index].rotation = (pagesData[index].rotation + 90) % 360;
            renderGrid();
        };

        window.deletePage = (index) => {
            pagesData.splice(index, 1);
            renderGrid();
        };

        window.resetGrid = () => {
            if(confirm("Reset all changes?")) location.reload();
        };

        // --- Drag & Drop ---
        let dragSrcEl = null;

        function handleDragStart(e) {
            this.classList.add('dragging');
            dragSrcEl = this;
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            if (e.preventDefault) e.preventDefault();
            return false;
        }

        function handleDrop(e) {
            e.stopPropagation();
            const fromIndex = parseInt(dragSrcEl.dataset.index);
            const toIndex = parseInt(this.dataset.index);

            if (fromIndex !== toIndex) {
                const movedItem = pagesData.splice(fromIndex, 1)[0];
                pagesData.splice(toIndex, 0, movedItem);
                renderGrid();
            }
            return false;
        }

        function handleDragEnd() {
            this.classList.remove('dragging');
        }

        // --- Download ---
        downloadBtn.addEventListener('click', async () => {
            downloadBtn.innerText = "Processing...";
            downloadBtn.disabled = true;

            try {
                if(pagesData.length === 0) throw new Error("No pages left!");

                const newPdf = await PDFLib.PDFDocument.create();
                
                for (const pageData of pagesData) {
                    const [copiedPage] = await newPdf.copyPages(pdfDoc, [pageData.originalIndex]);
                    const existingRotation = copiedPage.getRotation().angle;
                    copiedPage.setRotation(PDFLib.degrees(existingRotation + pageData.rotation));
                    newPdf.addPage(copiedPage);
                }

                const pdfBytes = await newPdf.save();
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'organized_document.pdf';
                link.click();
            } catch(e) {
                alert(e.message);
            }

            downloadBtn.innerText = "Download PDF";
            downloadBtn.disabled = false;
        });

    </script>
</body>
</html>