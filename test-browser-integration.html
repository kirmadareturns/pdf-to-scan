<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comment Stripper Browser Test</title>
    <script src="comment-stripper.js"></script>
</head>
<body>
    <h1>Comment Stripper Browser Integration Test</h1>
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function test(name, code, mode, expectedContains) {
            try {
                const result = window.CommentStripper.strip(code, mode);
                const passed = expectedContains.every(str => result.includes(str));
                results.innerHTML += `<p style="color: ${passed ? 'green' : 'red'}">
                    ${passed ? '✓' : '✗'} ${name}
                </p>`;
                if (!passed) {
                    console.error(`Failed: ${name}`);
                    console.log('Result:', result);
                }
            } catch (e) {
                results.innerHTML += `<p style="color: red">✗ ${name} - Error: ${e.message}</p>`;
                console.error(e);
            }
        }
        
        // Test 1: JavaScript comments
        test(
            'JS: Remove line comments',
            'const x = 5; // comment\nconst y = 10;',
            'javascript',
            ['const x = 5;', 'const y = 10;']
        );
        
        // Test 2: Preserve strings
        test(
            'JS: Preserve comment markers in strings',
            'const str = "// not a comment";',
            'javascript',
            ['const str = "// not a comment";']
        );
        
        // Test 3: Template literals
        test(
            'JS: Handle template literals',
            'const tpl = `Value: ${x /* comment */ + 5}`;',
            'javascript',
            ['const tpl = `Value: ${x  + 5}`;']
        );
        
        // Test 4: Regex
        test(
            'JS: Preserve regex literals',
            'const regex = /\\/\\/ not a comment/;',
            'javascript',
            ['const regex = /\\/\\/ not a comment/;']
        );
        
        // Test 5: CSS comments
        test(
            'CSS: Remove comments',
            'body { /* comment */ color: red; }',
            'css',
            ['body {', 'color: red; }']
        );
        
        // Test 6: CSS url()
        test(
            'CSS: Handle url() constructs',
            'background: url("https://example.com/image.png"); /* comment */',
            'css',
            ['background: url("https://example.com/image.png");']
        );
        
        // Test 7: HTML comments
        test(
            'HTML: Remove HTML comments',
            '<div>Content</div><!-- comment --><p>More</p>',
            'html',
            ['<div>Content</div>', '<p>More</p>']
        );
        
        // Test 8: HTML with script
        test(
            'HTML: Process inline scripts',
            '<script>\nconst x = 5; // comment\nalert(x);\n</script>',
            'html',
            ['<script>', 'const x = 5;', 'alert(x);', '</script>']
        );
        
        // Test 9: HTML with style
        test(
            'HTML: Process inline styles',
            '<style>\nbody { color: red; /* comment */ }\n</style>',
            'html',
            ['<style>', 'body { color: red;', '}', '</style>']
        );
        
        // Test 10: Auto-detect HTML
        test(
            'Auto: Detect HTML',
            '<!DOCTYPE html><html><!-- comment --><body></body></html>',
            'auto',
            ['<!DOCTYPE html><html>', '<body></body></html>']
        );
        
        // Test 11: Auto-detect CSS
        test(
            'Auto: Detect CSS',
            'body { /* comment */ color: red; }',
            'auto',
            ['body {', 'color: red; }']
        );
        
        // Test 12: Auto-detect JavaScript
        test(
            'Auto: Detect JavaScript',
            'const x = 5; // comment\n',
            'auto',
            ['const x = 5;']
        );
        
        results.innerHTML += '<h2 style="color: green;">All browser integration tests completed!</h2>';
        console.log('Browser integration tests completed');
    </script>
</body>
</html>
