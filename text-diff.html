<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIFF_ENGINE // TURBO</title>
    <style>
        :root {
            --bg: #1e1e1e;
            --border: #333;
            --accent: #ffff00; /* Industrial Yellow */
            --text: #cccccc;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Prevent body scroll, let editor handle it */
        }

        /* HEADER */
        header {
            height: 60px;
            background: #252526;
            border-bottom: 2px solid var(--accent);
            display: flex;
            align-items: center;
            padding: 0 20px;
            justify-content: space-between;
        }

        h1 {
            font-family: 'Courier New', monospace;
            font-weight: 900;
            color: #fff;
            text-transform: uppercase;
            font-size: 1.2rem;
            letter-spacing: 1px;
        }

        .badge {
            background: var(--accent);
            color: #000;
            padding: 2px 8px;
            font-weight: bold;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        /* CONTROLS */
        .controls {
            display: flex;
            gap: 10px;
        }

        .btn {
            background: #000;
            color: #fff;
            border: 1px solid #555;
            padding: 5px 15px;
            cursor: pointer;
            font-family: monospace;
            text-transform: uppercase;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .btn:hover { border-color: var(--accent); color: var(--accent); }

        /* EDITOR CONTAINER */
        #diff-container {
            flex-grow: 1;
            width: 100%;
            height: calc(100vh - 60px);
            position: relative;
        }

        /* Loading Overlay */
        #loader {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: #1e1e1e;
            display: flex; align-items: center; justify-content: center;
            z-index: 100;
            font-family: monospace;
            color: var(--accent);
        }

        /* AD SLOT (Placeholder) */
        .ad-banner {
            position: absolute; bottom: 0; right: 20px; z-index: 50;
            background: rgba(0,0,0,0.8); padding: 5px 10px;
            font-size: 0.7rem; border: 1px solid #444; color: #666;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <header>
        <div style="display:flex; align-items:center;">
            <h1>DIFF_ENGINE <span class="badge">V.1.0</span></h1>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="toggleInline()">TOGGLE_INLINE</button>
            <button class="btn" onclick="clearAll()">CLEAR_BUFFER</button>
        </div>
    </header>

    <div id="diff-container"></div>
    
    <div id="loader">
        [INITIALIZING MONACO KERNEL...]
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>

    <script>
        // --- CONFIGURATION ---
        // We use unpkg or cdnjs to load the heavy Monaco files efficiently
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' }});

        let diffEditor = null;
        let originalModel = null;
        let modifiedModel = null;

        // --- INIT ---
        require(['vs/editor/editor.main'], function () {
            
            // Remove Loader
            document.getElementById('loader').style.display = 'none';

            // 1. Define Defaults (100k Lines placeholder)
            const txtOriginal = "// PASTE ORIGINAL CODE HERE (LEFT SIDE)\n".repeat(1);
            const txtModified = "// PASTE MODIFIED CODE HERE (RIGHT SIDE)\n".repeat(1);

            // 2. Create Models
            originalModel = monaco.editor.createModel(txtOriginal, 'javascript');
            modifiedModel = monaco.editor.createModel(txtModified, 'javascript');

            // 3. Create Diff Editor Instance
            diffEditor = monaco.editor.createDiffEditor(document.getElementById('diff-container'), {
                // VISUAL SETTINGS
                theme: 'vs-dark',
                originalEditable: true, // Allow editing left side
                readOnly: false,        // Allow editing right side
                automaticLayout: true,
                renderSideBySide: true, // Split view default
                minimap: { enabled: true },
                
                // PERFORMANCE SETTINGS (CRITICAL FOR 100k LINES)
                enableSplitViewResizing: true,
                renderIndicators: true,
                scrollBeyondLastLine: false,
                diffWordWrap: 'off',    // Turn off wrapping for max speed
                maxComputationTime: 5000 // Allow 5s for massive diffs before fallback
            });

            diffEditor.setModel({
                original: originalModel,
                modified: modifiedModel
            });

            // Add Key Listener for Speed
            window.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'v') {
                    // Let normal paste happen, Monaco handles it.
                    // Just visual feedback could be added here.
                }
            });
        });

        // --- CONTROLS ---

        function toggleInline() {
            if (!diffEditor) return;
            const current = diffEditor.getOption(monaco.editor.EditorOption.renderSideBySide);
            diffEditor.updateOptions({
                renderSideBySide: !current
            });
        }

        function clearAll() {
            if (!originalModel || !modifiedModel) return;
            originalModel.setValue('');
            modifiedModel.setValue('');
        }

        // --- AUTO-DETECT LANGUAGE ---
        // Advanced: If user pastes HTML, switch highlighting to HTML
        function detectLang(text) {
            if (text.trim().startsWith('<')) return 'html';
            if (text.includes('function') || text.includes('const')) return 'javascript';
            if (text.includes('def ') || text.includes('import ')) return 'python';
            return 'plaintext';
        }

        // Monitor pastes to switch language (Optional optimization)
        // We stick to JS/Text default for speed.

    </script>
</body>
</html>
